#!/usr/bin/ruby

def width(word)
    return word.chars.map{|c|  c.ascii_only? ? 1 : 2 }.inject(0, &:+)
end

s = `ithief information`
if md = s.match(/playing "(.+?)" by/)
    name = md[1]
    playing = true
else
    name = '-----'
    playing = false
end
if md = s.match(/by (.+?) in/)
    artist = md[1]
else
    artist = '-----'
end
s = (name + ' ／ ' + artist)

w = 35
str = ''
if width(s) > w
    s += ' ' * 10
    for i in 0 .. s.length * 2
        str += s[( ( Time.now.sec + Time.now.min * 60 ) * 1 + i ) % s.length]
        if width(str) > w - 3
            break
        end
    end
    s = str
end
space_num = w - width(s) >= 0 ? w - width(s) : 0
s = s + ' ' * ( space_num )

colors = [
    'colour40',
    'colour41',
    'colour42',
    'colour43',
    'colour44',
    'colour45',
]
colors += colors.reverse[1..colors.length-2]

ret = '#[bg=dark]' + '#[fg=' + colors[playing ? Time.now.sec % colors.length : 0] + ']' + '♪ ' + s + ' #[default]'
puts ret 

