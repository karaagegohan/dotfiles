#! /bin/bash

function usage() {
Usage:
  $(basename $0) [-a] [-b]

Description:
  Get information about the music playing now.

Options:
  -a    artist
  -t    title
_EOT_
exit 1
}

function title() {
  echo $(osascript -e 'tell application "iTunes" to if player state is playing then name of current track')
}

function artist() {
  echo $(osascript -e 'tell application "iTunes" to if player state is playing then artist of current track')
}

function icon(){
  echo ðŸŽ¹
}

DISPLAY=""

if [ "$(title)" = "" ]; then
  exit 1
fi

if [ "$OPTIND" = 1 ]; then
  while getopts :atpf: OPT
  do
    case $OPT in
      a)
        DISPLAY=$DISPLAY artist
        ;;
      t)
        DISPLAY=$DISPLAY title
        ;;
      p)
        DISPLAY=$DISPLAY playing
        ;;
      f)
        DISPLAY=$( \
          echo ${OPTARG} \
          | sed -e "s/%artist/$(artist)/g" \
          | sed -e "s/%title/$(title)/g" \
          | sed -e "s/%icon/$(icon)/g" \
          )
        ;;
      h)
        usage
        ;;
      *)
        usage
        ;;
    esac
  done
fi

echo $DISPLAY

