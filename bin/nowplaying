#!/usr/bin/ruby

def width(word)
    return word.chars.map{|c|  c.ascii_only? ? 1 : 2 }.inject(0, &:+)
end

s = `ithief information`
if md = s.match(/playing "(.+?)" by/)
    name = md[1]
else
    name = '-----'
end
if md = s.match(/by (.+?) in/)
    artist = md[1]
else
    artist = '-----'
end
colors = [
    'colour40',
    'colour41',
    'colour42',
    'colour43',
    'colour44',
    'colour45',
]

w = 30
charnum = 20
str = ''
s = (name + '／' + artist)
if width(s) >= w
    s += ' ' * 18
    for i in 0 .. charnum
        str += s[( Time.now.sec + Time.now.min * 60 + i ) % s.length]
    end
else
    str = s
end
colors += colors.reverse[1..colors.length-2]
ret = '#[bg=dark]' + '#[fg=' + colors[Time.now.sec % colors.length] + ']' + '♪ ' + str
puts ret + ' ' * ( w - width(str))

