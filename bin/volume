#!/bin/bash
vol=$(osascript -e "(get volume settings)'s output volume")
mute=$(osascript -e "(get volume settings)'s output muted")
if [ $mute = "true" ] ;then 
  vol=0
fi

DISPLAY="${vol}%"

for i in "$@"
do
  case "$i" in
    "-t")
      if (( $vol == 0 )); then
        DISPLAY="#[fg=white]${DISPLAY}#[default]"
      elif (( $vol < 33 )); then
        DISPLAY="#[fg=blue]${DISPLAY}#[default]"
      elif (( $vol < 67  )); then
        DISPLAY="#[fg=green]${DISPLAY}#[default]"
      elif (( $vol < 100  )); then
        DISPLAY="#[fg=yellow]${DISPLAY}#[default]"
      else
        DISPLAY="#[fg=red]${DISPLAY}#[default]"
      fi
      ;;
    -*)
      echo "$i: unknown option" 1>&2
      exit 1
      ;;
  esac
done

echo $DISPLAY
