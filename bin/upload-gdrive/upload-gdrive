#!/usr/bin/env ruby

require "google_drive"

# display usage
if ARGV.length == 0
  puts 'Usage: ' + File.basename(__FILE__) + ' filename'
  exit
end

if ARGV[0] == 'GoogleDrive'
  exit
end

# information about uploading file
file        = File.expand_path(ARGV[0])
basename    = File.basename(file)
folder_name = File.extname(file).delete('.')
folder_name = 'others' if folder_name == ''

# authentication
jsonFile = File.expand_path(Dir.glob("*.json").to_s)
session = GoogleDrive::Session.from_config(jsonFile)

# list of folder name
folders = session.files.select {|file| file.class.to_s == 'GoogleDrive::Collection'}
folders.map!(&:title)

# Creat a folder if it doesn't exist.
if folders.include?(folder_name) 
else
  session.root_collection.create_subcollection(folder_name)
end

# Uploads a local file.
session.upload_from_file(file, basename, convert: false)
gFile = session.file_by_title(basename)
gFolder = session.file_by_title(folder_name)
gFolder.add(gFile)
session.root_collection.remove(gFile)

trash = File.expand_path("~/.Trash/")
FileUtils.mv(file, trash)

